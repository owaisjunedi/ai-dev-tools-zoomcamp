{% extends 'todo/base.html' %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Create{% endif %} Todo{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body p-4">
                <h2 class="mb-4">{% if form.instance.pk %}Edit{% else %}Create{% endif %} Todo</h2>

                <form method="post">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label for="{{ form.title.id_for_label }}" class="form-label">Title *</label>
                        {{ form.title }}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                        {{ form.description }}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.tags.id_for_label }}" class="form-label">Tags</label>
                        {{ form.tags }}
                        <small class="text-muted d-block mt-1">Comma-separated (e.g., work, personal)</small>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.due_date.id_for_label }}" class="form-label">Due Date</label>
                        <div class="d-flex gap-2 mb-2 flex-wrap">
                            <button type="button" class="btn btn-sm btn-outline-primary"
                                onclick="setQuickDate('today')">Today</button>
                            <button type="button" class="btn btn-sm btn-outline-primary"
                                onclick="setQuickDate('tomorrow')">Tomorrow</button>
                            <button type="button" class="btn btn-sm btn-outline-primary"
                                onclick="setQuickDate('nextWeek')">Next Week</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary"
                                onclick="clearDate()">Clear</button>
                        </div>
                        {{ form.due_date }}
                    </div>

                    <div class="mb-4">
                        <div class="form-check">
                            {{ form.is_resolved }}
                            <label class="form-check-label" for="{{ form.is_resolved.id_for_label }}">
                                Mark as Completed
                            </label>
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <a href="{% url 'todo-list' %}" class="btn btn-outline-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function setQuickDate(option) {
        const dateInput = document.getElementById('{{ form.due_date.id_for_label }}');
        const now = new Date();
        let targetDate = new Date();

        switch (option) {
            case 'today':
                targetDate.setHours(23, 59, 0, 0);
                break;
            case 'tomorrow':
                targetDate.setDate(now.getDate() + 1);
                targetDate.setHours(23, 59, 0, 0);
                break;
            case 'nextWeek':
                targetDate.setDate(now.getDate() + 7);
                targetDate.setHours(23, 59, 0, 0);
                break;
        }

        const year = targetDate.getFullYear();
        const month = String(targetDate.getMonth() + 1).padStart(2, '0');
        const day = String(targetDate.getDate()).padStart(2, '0');
        const hours = String(targetDate.getHours()).padStart(2, '0');
        const minutes = String(targetDate.getMinutes()).padStart(2, '0');

        dateInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    function clearDate() {
        const dateInput = document.getElementById('{{ form.due_date.id_for_label }}');
        dateInput.value = '';
    }
</script>
{% endblock %}